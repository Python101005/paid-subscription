# (main.py)
import logging
from aiogram import Bot, Dispatcher, executor, types
from aiogram.types.message import ContentType
import markups as nav

TOKEN = "2138685259:AAGnTfkQUs8L9LCnKsxl-JbFQVihI2PSsfA"
YOOTOKEN = "381764678:TEST:30765"


logging.basicConfig(level=logging.INFO)

# Initialize bot
bot = Bot(token=TOKEN)
dp = Dispatcher(bot)

@dp.message_handler(commands=['start'])
async def start(message: types.Message):
    await bot.send_message(message.from_user.id, '–î–æ–±—Ä—ã–π –¥–µ–Ω—å', reply_markup = nav.mainMenu)


@dp.message_handler()
async def bot_message(message: types.Message):
    if message.chat.type == 'private':
        if message.text == '‚ù§ –ü–û–î–ü–ò–°–ö–ê':
            await bot.send_message(message.from_user.id, '–û–ø–∏—Å–∞–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –ø–æ–¥–ø–∏—Å–∫–∏', reply_markup = nav.sub_inline_markup)


@dp.callback_query_handler(text="submonth")
async def submonth(call: types.CallbackQuery):
    await bot.delete_message(call.from_user.id, call.message.message_id)
    await bot.send_invoice(chat_id=call.from_user.id, title="–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏", description="–¢–µ—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞", payload="month_sub", provider_token=YOOTOKEN, currency="RUB", start_parameter="test_bot", prices=[{"label": "–†—É–±", "amount": 15000}])

@dp.pre_checkout_query_handler()
async def process_pre_checkout_query(pre_checkout_query: types.PreCheckoutQuery):
    await bot.answer_pre_checkout_query(pre_checkout_query.id, ok=True)

@dp.message_handler(content_types=ContentType.SUCCESSFUL_PAYMENT)
async def process_pay(message: types.Message):
    if message.successful_payment.invoice_payload == "month_sub":
        # –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        await bot.send_message(message.from_user.id, "–í–∞–º –≤—ã–¥–∞–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –º–µ—Å—è—Ü!")


if __name__ == "__main__":
    executor.start_polling(dp, skip_updates = True)
    
# (markups.py)
from aiogram.types import ReplyKeyboardMarkup, KeyboardButton, InlineKeyboardMarkup, InlineKeyboardButton

# --- Main menu ---
btnSub = KeyboardButton('‚ù§ –ü–û–î–ü–ò–°–ö–ê')
btnSettings = KeyboardButton('üõ† –ù–ê–°–¢–†–û–ô–ö–ò')
mainMenu = ReplyKeyboardMarkup(resize_keyboard = True)
mainMenu.add(btnSub)
mainMenu.add(btnSettings)

# --- Subscribe Inline Buttons ---
sub_inline_markup = InlineKeyboardMarkup(row_width=1)

btnSubMonth = InlineKeyboardButton(text="–ú–µ—Å—è—Ü - 150 —Ä—É–±–ª–µ–π", callback_data="submonth")

sub_inline_markup.insert(btnSubMonth)



    
    
